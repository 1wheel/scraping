var fs = require('fs')
var d3 = require('d3')
var request = require('request')
var cheerio = require('cheerio')
var queue = require('queue-async')
var _ = require('underscore')
var glob = require("glob")




http://www.theplayerstribune.com/wp-admin/admin-ajax.php?action=alm_query_posts&query_type=standard&nonce=27ee2f1043&repeater=repeater2&theme_repeater=null&alternate=&comments=&post_type%5B%5D=post&post_format=&category=&category__not_in=&tag=&tag__not_in=&taxonomy=&taxonomy_terms=&taxonomy_operator=&taxonomy_relation=&meta_key=&meta_value=&meta_compare=&meta_relation=&meta_type=&author=&year=&month=&day=&post_status=&order=&orderby=&post__in=16321%2C60270%2C59910%2C11832%2C49547%2C60903%2C44744%2C60921%2C61454%2C61431%2C9654%2C61487%2C61391%2C61200%2C61066%2C60276%2C61265%2C61263%2C61095%2C60858%2C60972%2C60283%2C60206%2C60481%2C53692%2C59906%2C60046%2C58813%2C60367%2C60314%2C58713%2C59935%2C59650%2C59759%2C59600%2C59379%2C59441%2C58234%2C58237%2C59271%2C59621%2C57773%2C58188%2C40797%2C58760%2C58816%2C59131%2C58720%2C58921%2C58547%2C55602%2C58676%2C57759%2C55267%2C57491%2C57545%2C31630%2C57538%2C60313%2C56581%2C54204%2C59603%2C55490%2C57419%2C57035%2C56793%2C59652%2C58099%2C57468%2C57060%2C55692%2C54274%2C57281%2C57957%2C55462%2C57614%2C4097%2C56701%2C57375%2C56242%2C56703%2C56529%2C55494%2C56699%2C55946%2C55935%2C56987%2C56011%2C56697%2C56586%2C55900%2C56481%2C56027%2C56635%2C56061%2C56063%2C55878%2C55686%2C56351%2C56004%2C55729%2C54964%2C53061%2C59900%2C46168%2C55763%2C54781%2C54704%2C54402%2C55514%2C54935%2C54527%2C55149%2C53764%2C54578%2C55066%2C52271%2C54865%2C55296%2C60999%2C60633%2C54392%2C54895%2C54784%2C54582%2C54969%2C30319%2C54630%2C61261%2C61251%2C54410%2C54001%2C61264%2C54731%2C53975%2C51881%2C52520%2C54112%2C52816%2C54312%2C42741%2C54011%2C27356%2C53804%2C53818%2C53657%2C53129%2C53623%2C52446%2C52744%2C53514%2C52810%2C46346%2C52237%2C59944%2C44563%2C52989%2C52749%2C51623%2C53567%2C51873%2C53117%2C51976%2C46765%2C49351%2C49372%2C49439%2C48847%2C47102%2C48872%2C48673%2C48841%2C45954%2C46762%2C49063%2C48763%2C48410%2C61262%2C48119%2C47426%2C47355%2C48357%2C48444%2C48278%2C48180%2C48545%2C48197%2C47868%2C53751%2C47747%2C47795%2C47306%2C47662%2C47694%2C46737%2C47094%2C45577%2C47245%2C46758%2C47225%2C47140%2C46976%2C46920%2C46808%2C46106%2C41683%2C46460%2C46309%2C45708%2C36128%2C41781%2C46219%2C46351%2C45801%2C45337%2C45415%2C45655%2C45580%2C45778%2C37984%2C45267%2C45050%2C45762%2C44859%2C45089%2C39907%2C44980%2C45230%2C44878%2C44556%2C42423%2C44005%2C43681%2C44314%2C38729%2C49327%2C45197%2C46898%2C43723%2C43864%2C46813%2C43965%2C43718%2C44615%2C43636%2C44024%2C44279%2C43888%2C43235%2C41446%2C43889%2C41458%2C43887%2C41476%2C40776%2C44028%2C43469%2C43339%2C42937%2C42182%2C46766%2C44856%2C40180%2C43068%2C47163%2C43415%2C53253%2C43578%2C53267%2C42173%2C43269%2C41597%2C52853%2C42215%2C41534%2C40813%2C43146%2C44786%2C52339%2C42569%2C52795%2C36384%2C51576%2C42918%2C51771%2C42424%2C50048%2C41018%2C47065%2C40767%2C46587%2C40746%2C52376%2C41788%2C52505%2C40562%2C51654%2C41868%2C52403%2C40997%2C52314%2C46761%2C38916%2C52187%2C41588%2C51561%2C39865%2C44479%2C51646%2C41786%2C50929%2C41307%2C51653%2C42568%2C50773%2C41071%2C51232%2C41339%2C50622%2C41222%2C24613%2C51197%2C41268%2C39370%2C39288%2C5759%2C41302%2C47540%2C40147%2C49671%2C48734%2C51276%2C41112%2C51313%2C40846%2C3290%2C40273%2C50663%2C39627%2C49602%2C40729%2C50959%2C39799%2C46756%2C39952%2C50955%2C40885%2C50973%2C35017%2C50328%2C40394%2C49693%2C38701%2C50133%2C40648%2C50044%2C38995%2C49931%2C40364%2C50381%2C40191%2C50333%2C40542%2C47187%2C40519%2C49674%2C42353%2C50196%2C40343%2C46764%2C39232%2C50127%2C39599%2C49687%2C45221%2C48130%2C39657%2C49505%2C40061%2C49796%2C43751%2C49389%2C39285%2C48710%2C38652%2C48921%2C36273%2C49293%2C39813%2C48982%2C38779%2C38120%2C38881%2C39384%2C28249%2C27420%2C37264%2C37851%2C39164%2C39244%2C39135%2C37776%2C38422%2C38923%2C38137%2C37612%2C38503%2C37070%2C38382%2C39101%2C38196%2C38212%2C37647%2C34132%2C35113%2C37194%2C43833%2C38492%2C37093%2C37892%2C38255%2C37856%2C37854%2C37859%2C36624%2C37802%2C36972%2C37160%2C36150%2C37787%2C37666%2C37063%2C36041%2C37004%2C46763%2C46760%2C33671%2C37105%2C36067%2C37002%2C35695%2C42077%2C36197%2C34377%2C34885%2C36720%2C36750%2C36787%2C37417%2C36931%2C36626%2C35858%2C34385%2C36673%2C36393%2C47427%2C35515%2C36390%2C36132%2C42804%2C34341%2C36738%2C36217%2C35022%2C43000%2C35628%2C32707%2C35391%2C36098%2C36876%2C34507%2C44606%2C36171%2C35179%2C35373%2C35749%2C33225%2C35561%2C35320%2C34500%2C34086%2C35001%2C34383%2C34931%2C34710%2C35074%2C34836%2C34081%2C34192%2C29569%2C34227%2C34698%2C34407%2C34026%2C34514%2C34265%2C33387%2C36890%2C32153%2C33296%2C33615%2C33106%2C20920%2C32917%2C33748%2C33457%2C33965%2C25819%2C33636%2C9066%2C32916%2C20902%2C33395%2C31751%2C31283%2C33536%2C32828%2C32577%2C32557%2C29782%2C31807%2C33273%2C33015%2C32823%2C32468%2C32520%2C32914%2C31947%2C31345%2C32463%2C32773%2C31614%2C32086%2C32477%2C32221%2C31555%2C31749%2C31878%2C31699%2C31914%2C31792%2C31692%2C31298%2C31576%2C30673%2C31484%2C31508%2C31069%2C26673%2C31016%2C31560%2C31366%2C31147%2C31194%2C31094%2C31445%2C25659%2C31446%2C31151%2C28662%2C13853%2C30709%2C22701%2C30770%2C29630%2C28785%2C30418%2C30780%2C31320%2C30542%2C30214%2C30693%2C30443%2C30548%2C31535%2C30316%2C30507%2C30777%2C30455%2C29198%2C30575%2C29540%2C28524%2C29100%2C29942%2C30491%2C29260%2C30408%2C25933%2C26657%2C29673%2C29639%2C29890%2C29921%2C44071%2C28857%2C28335%2C22827%2C26485%2C29304%2C30218%2C29675%2C29369%2C29201%2C29919%2C29620%2C29478%2C28956%2C29350%2C40130%2C29432%2C28776%2C29135%2C28807%2C28778%2C28407%2C28464%2C29125%2C28918%2C22649%2C28582%2C28695%2C28838%2C28726%2C28388%2C28271%2C27662%2C28240%2C26504%2C27042%2C28531%2C26864%2C28502%2C28395%2C27792%2C32913%2C28396%2C27413%2C27620%2C28198%2C26488%2C27806%2C34577%2C27326%2C27292%2C26967%2C27711%2C31781%2C27627%2C34291%2C27609%2C31763%2C27549%2C27441%2C27812%2C27251%2C26120%2C27098%2C27261%2C26866%2C26263%2C29366%2C26221%2C27106%2C27287%2C26834%2C26426%2C27057%2C24067%2C26786%2C25142%2C35158%2C26286%2C26394%2C25726%2C24525%2C26205%2C25887%2C25969%2C25910%2C25063%2C25719%2C20841%2C25740%2C26447%2C32853%2C25020%2C25774%2C25609%2C25478%2C25111%2C24915%2C24338%2C25241%2C24985%2C24845%2C37668%2C23093%2C20995%2C24470%2C26594%2C32915%2C24945%2C24723%2C24168%2C24816%2C24475%2C24264%2C24166%2C24397%2C24240%2C24003%2C21967%2C24117%2C24116%2C23157%2C23905%2C23777%2C23446%2C23556%2C24191%2C24152%2C23791%2C23301%2C24000%2C24124%2C21719%2C23936%2C23515%2C19730%2C23733%2C23609%2C23754%2C23507%2C21717%2C23155%2C23381%2C24389%2C23591%2C22451%2C23236%2C25273%2C23291%2C21623%2C22566%2C22816%2C28025%2C22194%2C22971%2C23126%2C22376%2C20526%2C28506%2C22970%2C21809%2C20253%2C22555%2C22852%2C22083%2C21816%2C20152%2C21955%2C21520%2C26253%2C21055%2C17369%2C24848%2C29963%2C21557%2C20098%2C20574%2C20512%2C21722%2C21284%2C21480%2C21287%2C21125%2C21142%2C21128%2C25681%2C21165%2C25078%2C9859%2C21224%2C20968%2C20781%2C20719%2C20654%2C20678%2C20793%2C20894%2C20628%2C20209%2C19544%2C20553%2C20239%2C20023%2C20155%2C19945%2C19702%2C19369%2C19932%2C30681%2C21781%2C19803%2C16436%2C15489%2C15786%2C19766%2C19636%2C20476%2C19818%2C28473%2C19572%2C29570%2C19663%2C19416%2C19427%2C18887%2C17296%2C19372%2C18620%2C19072%2C19082%2C19077%2C18809%2C18846%2C18829%2C18777%2C17928%2C18707%2C18514%2C18710%2C18608%2C18222%2C15652%2C18491%2C17532%2C18670%2C17703%2C17896%2C20320%2C15446%2C17727%2C17307%2C16963%2C19361%2C17308%2C19243%2C16936%2C17600%2C17083%2C19934%2C14503%2C17253%2C14666%2C17019%2C16967%2C16186%2C16835%2C28773%2C16429%2C16754%2C33988%2C29641%2C16391%2C28612%2C16530%2C13706%2C16426%2C15239%2C16097%2C22923%2C15692%2C16036%2C16017%2C16206%2C14362%2C13323%2C15877%2C16110%2C15859%2C15754%2C16177%2C15724%2C15718%2C19589%2C24907%2C15795%2C15177%2C16564%2C15497%2C13612%2C15466%2C15377%2C11734%2C15167%2C15254%2C15275%2C14399%2C14916%2C15026%2C17036%2C14923%2C14848%2C14982%2C18851%2C18439%2C13151%2C14589%2C13619%2C13144%2C14637%2C14485%2C14806%2C8595%2C14520%2C12806%2C17012%2C14525%2C13153%2C1910%2C14439%2C14683%2C24917%2C14318%2C18992%2C14558%2C14114%2C17281%2C13161%2C13005%2C12982%2C21611%2C14075%2C13710%2C19029%2C13357%2C14209%2C13154%2C13755%2C10055%2C13002%2C12997%2C12967%2C13465%2C13351%2C11595%2C12014%2C12270%2C9639%2C11810%2C10480%2C12736%2C12871%2C12463%2C25036%2C12799%2C12568%2C11601%2C11758%2C11474%2C11701%2C11656%2C12559%2C12163%2C12107%2C12076%2C19680%2C11771%2C11768%2C10648%2C11977%2C11000%2C16443%2C11541%2C11373%2C11421%2C14135%2C11315%2C10853%2C11302%2C17138%2C11118%2C11214%2C11033%2C10067%2C11186%2C12431%2C18422%2C11077%2C10868%2C10692%2C10790%2C10647%2C10807%2C10697%2C10597%2C10493%2C10440%2C10600%2C11041%2C10223%2C10387%2C9982%2C10219%2C10285%2C14400%2C10274%2C10001%2C10110%2C10142%2C9455%2C12847%2C10080%2C8915%2C9806%2C10016%2C15599%2C9874%2C9514%2C9787%2C9762%2C9517%2C9533%2C9626%2C9448%2C9064%2C3604%2C8519%2C30642%2C9223%2C9351%2C9250%2C9047%2C8912%2C9180%2C8292%2C9523%2C8466%2C8365%2C15737%2C8498%2C8440%2C8682%2C7754%2C8088%2C8266%2C8379%2C12090%2C8199%2C7676%2C7557%2C7848%2C7767%2C7964%2C7967%2C6136%2C8036%2C7683%2C7761%2C12470%2C7874%2C7775%2C7769%2C26679%2C7109%2C7666%2C7641%2C7628%2C7620%2C7014%2C7357%2C10193%2C7560%2C7499%2C7430%2C7477%2C7022%2C7126%2C6937%2C7226%2C6754%2C6524%2C6987%2C6971%2C6954%2C6895%2C6779%2C6885%2C6563%2C6799%2C8183%2C6786%2C6735%2C6588%2C6707%2C6647%2C6325%2C12540%2C6066%2C6641%2C6526%2C10670%2C6480%2C8211%2C6506%2C6249%2C6425%2C6368%2C6361%2C6226%2C8473%2C6304%2C6298%2C6138%2C6192%2C5401%2C4664%2C4404%2C6015%2C5881%2C5936%2C5845%2C5303%2C5839%2C5781%2C5372%2C8904%2C5792%2C5754%2C5341%2C5505%2C5492%2C5021%2C20308%2C4763%2C5063%2C5313%2C5299%2C5181%2C5135%2C7943%2C5261%2C5226%2C8556%2C8631%2C5003%2C5199%2C5080%2C4989%2C4977%2C4965%2C4659%2C4909%2C4871%2C4273%2C4681%2C4792%2C17751%2C4266%2C4070%2C4690%2C8624%2C3197%2C4604%2C2815%2C4539%2C4565%2C4514%2C4428%2C4244%2C4418%2C4345%2C4331%2C4231%2C4111%2C4114%2C4085%2C2840%2C4042%2C9612%2C4022%2C3993%2C3992%2C3984%2C3621%2C19220%2C3838%2C9403%2C25324%2C3892%2C3849%2C3306%2C12333%2C3774%2C3758%2C3745%2C3735%2C3722%2C3656%2C3489%2C3631%2C3483%2C11053%2C2978%2C3343%2C10459%2C3347%2C3188%2C3136%2C3125%2C3078%2C3064%2C3067%2C2945%2C10784%2C2950%2C2831%2C2902%2C2428%2C8540%2C2825%2C2773%2C8829%2C8766%2C2366%2C2750%2C2709%2C2580%2C2557%2C2504%2C12158%2C2573%2C2545%2C2477%2C2151%2C2399%2C14767%2C2330%2C8118%2C2316%2C1908%2C2276%2C2244%2C8805%2C8391%2C2210%2C1644%2C2186%2C2096%2C2076%2C2055%2C1990%2C1970%2C1921%2C1915%2C21458%2C1579%2C1892%2C1781%2C1837%2C1624%2C1746%2C1680%2C1615%2C628%2C1057%2C1498%2C1327%2C1398%2C1219%2C967%2C835%2C549%2C591%2C497%2C349%2C325%2C330%2C337%2C342%2C377%2C8324%2C7918%2C7420%2C8239%2C1869%2C6458%2C6124%2C4767%2C4269%2C3526%2C2733%2C2124%2C1724%2C259%2C313%2C7031%2C9125%2C8965%2C3230%2C9274%2C9420%2C9458%2C9559%2C9697%2C9847%2C10006%2C10134%2C10259%2C10545%2C10633%2C10751%2C10773%2C10897%2C11028%2C11255%2C11449%2C11517%2C11529%2C11552%2C11694%2C11773%2C11898%2C12001%2C12017%2C12128%2C17498%2C12084%2C12147%2C12316%2C12344%2C12454%2C12566%2C12743%2C12819%2C12858%2C12884%2C12991%2C13132%2C13347%2C13648%2C13664%2C13682%2C13817%2C13940%2C14055%2C14117%2C14273%2C16812%2C14307%2C14324%2C14428%2C14619%2C14883%2C14910%2C15014%2C15072%2C15088%2C15204%2C15248%2C15351%2C15419%2C15426%2C15437%2C13482%2C15552%2C15698%2C15824%2C16166%2C15959%2C18607%2C16190%2C16291%2C16374%2C16380%2C16463%2C16694%2C16777%2C16790%2C18401%2C17838%2C17866%2C17886%2C17907%2C18355%2C19279%2C19347%2C19422%2C19886%2C20178%2C20682%2C20867%2C20880%2C20974%2C21083%2C21699%2C21705%2C21726%2C22378%2C23046%2C23194%2C23214%2C23483%2C24747%2C24887%2C25463%2C25698%2C25704%2C25731%2C25883%2C26026%2C26155%2C26214%2C23907%2C26396%2C27475%2C26284%2C27713%2C28261%2C28683%2C28811%2C29115%2C28970%2C29399%2C30252%2C30917%2C31468%2C31616%2C31640%2C31817%2C32623%2C32808%2C33063%2C33298%2C33878%2C34124%2C34414%2C34593%2C34730%2C34943%2C35527%2C35345%2C36247%2C36526%2C36714%2C36962%2C37256%2C37470%2C37598%2C37737%2C37877%2C38297%2C38429%2C38529%2C38590%2C38668%2C38705%2C38770%2C38884%2C39037%2C39268%2C39133%2C39324%2C39485%2C3948%2C39546%2C39704%2C39869%2C40165%2C40323%2C40505%2C39857%2C40625%2C40761%2C40954%2C41031%2C41198%2C41637%2C41878%2C24794%2C10369%2C45474%2C46408%2C46921%2C46607%2C55291%2C14105&post__not_in=&exclude=&search=&custom_args=&posts_per_page=6&pageNumber=0&offset=12&preloaded=false&seo_start_page=1&previous_post=false&previous_post_id=&previous_post_taxonomy=&lang=&slug=2016-6-4-muhammad-ali-the-chirp


http://www.theplayerstribune.com/wp-admin/admin-ajax.php?action=alm_query_posts&query_type=standard&nonce=27ee2f1043&repeater=repeater2&posts_per_page=6&pageNumber=0&offset=12

http://www.theplayerstribune.com/wp-admin/admin-ajax.php?action=alm_query_posts&query_type=standard&nonce=27ee2f1043&repeater=repeater2&posts_per_page=6&pageNumber=1&offset=12&order=DESC&orderby=date

http://www.theplayerstribune.com/wp-admin/admin-ajax.php?action=alm_query_posts&query_type=standard&nonce=27ee2f1043&repeater=repeater2&theme_repeater=null&alternate=&comments=&post_type%5B%5D=post&post_format=&category=&category__not_in=&tag=&tag__not_in=&taxonomy=tpt_sport&taxonomy_terms=basketball&taxonomy_operator=&taxonomy_relation=&meta_key=&meta_value=&meta_compare=&meta_relation=&meta_type=&author=&year=&month=&day=&post_status=&order=DESC&orderby=date&post__in=&post__not_in=&exclude=&search=&custom_args=&posts_per_page=6&pageNumber=0&offset=12&preloaded=false&seo_start_page=1&


http://www.theplayerstribune.com/wp-admin/admin-ajax.php?action=alm_query_posts&query_type=standard&nonce=27ee2f1043&repeater=repeater2&theme_repeater=null&alternate=&comments=&post_type%5B%5D=post&post_format=&category=&category__not_in=&tag=&tag__not_in=&taxonomy=tpt_sport&taxonomy_terms=basketball&taxonomy_operator=&taxonomy_relation=&meta_key=&meta_value=&meta_compare=&meta_relation=&meta_type=&author=&year=&month=&day=&post_status=&order=DESC&orderby=date&post__in=&post__not_in=&exclude=&search=&custom_args=&posts_per_page=6&pageNumber=0&offset=0&preloaded=false&seo_start_page=0&

http://www.theplayerstribune.com/wp-admin/admin-ajax.php?action=alm_query_posts&query_type=standard&nonce=27ee2f1043&theme_repeater=null&alternate=&comments=&post_type%5B%5D=post&post_format=&category=&category__not_in=&tag=&tag__not_in=&taxonomy=tpt_sport&taxonomy_terms=basketball&taxonomy_operator=&taxonomy_relation=&meta_key=&meta_value=&meta_compare=&meta_relation=&meta_type=&author=&year=&month=&day=&post_status=&order=DESC&orderby=date&post__in=&post__not_in=&exclude=&search=&custom_args=&posts_per_page=6&pageNumber=0&offset=0&preloaded=false&seo_start_page=0&


http://www.theplayerstribune.com/wp-admin/admin-ajax.php?action=alm_query_posts&repeater=repeater2&taxonomy=tpt_sport&taxonomy_terms=basketball&order=DESC&orderby=date&posts_per_page=6000&pageNumber=0&offset=0
http://www.theplayerstribune.com/wp-admin/admin-ajax.php?action=alm_query_posts&repeater=repeater2&taxonomy=tpt_sport&taxonomy_terms=more&order=DESC&orderby=date&posts_per_page=6000&pageNumber=0&offset=0
var games = []

// glob.sync(__dirname + "/raw-series/*").forEach(scrape)

// function scrape(dir, i){
//   var series = dir.split('/raw-series/')[1]

//   process.stdout.write("parsing " + i + " " + series + "\r")

//   var html = fs.readFileSync(dir, 'utf-8')
//   var $ = cheerio.load(html)

//   $('a').each(function(i){
//     var str = $(this).text()
//     var href = $(this).attr('href')

//     if (str == 'box scores' || !~href.indexOf('/boxscores/') || i % 2) return

//     games.push({series: series, boxLink: $(this).attr('href').replace('/boxscores/', '')})
//   })
// }

// fs.writeFileSync(__dirname + '/playoffGames.csv', d3.csv.format(games))



// var q = queue(1)
// var downloaded = glob.sync(__dirname + '/raw-box/*.html').map(d => d.split('/raw-box/')[1])

// games
//     .map(d => d.boxLink)
//     .filter(d =>  !_.contains(downloaded, d))
//     .forEach(d => q.defer(downloadBox, d)) 

// function downloadBox(d, cb){
//   process.stdout.write("downloading " + d + "\r");

//   var url = 'http://www.basketball-reference.com/boxscores/' + d
//   // console.log(url)
//   setTimeout(cb, 1000)
//   request(url, function(error, response, html){
//     var path = __dirname + '/raw-box/' + d
//     fs.writeFileSync(path, html)
//   })
// }
