<!DOCTYPE html>
<meta charset="utf-8">
<style>

input,
canvas {
  position: absolute;
}

input {
  background: transparent;
  border: none;
  margin: 10px 384px;
  width: 180px;
  font-size: 18px;
  padding: 6px;
  text-align: center;
}

</style>

<script src="http://d3js.org/d3.v3.min.js"></script>
<script src="http://www.bloomberg.com/graphics/assets/js/vendor/queue.v1.min.js?"></script>
<script src="http://www.bloomberg.com/graphics/assets/js/vendor/lodash.underscore.min.js?"></script>

<script src='http://bl.ocks.org/1wheel/raw/1b6758978dc2d52d3a37/d3-jetpack.js'></script>
<script src='http://bl.ocks.org/1wheel/raw/1b6758978dc2d52d3a37/d3-starterkit.js'></script>

<script>


var abvToTeam = {
  "ANA": "Los Angeles Angels of Anaheim",
  "ARI": "Arizona Diamondbacks",
  "ATL": "Atlanta Braves",
  "BAL": "Baltimore Orioles",
  "BOS": "Boston Red Sox",
  "CHA": "Chicago White Sox",
  "CHN": "Chicago Cubs",
  "CIN": "Cincinnati Reds",
  "CLE": "Cleveland Indians",
  "COL": "Colorado Rockies",
  "DET": "Detroit Tigers",
  "HOU": "Houston Astros",
  "KCA": "Kansas City Royals",
  "LAN": "Los Angeles Dodgers",
  "MIA": "Miami Marlins",
  "MIL": "Milwaukee Brewers",
  "MIN": "Minnesota Twins",
  "NYA": "New York Mets",
  "NYN": "New York Yankees",
  "OAK": "Oakland Athletics",
  "PHI": "Philadelphia Phillies",
  "PIT": "Pittsburgh Pirates",
  "SDN": "San Diego Padres",
  "SEA": "Seattle Mariners",
  "SFN": "San Francisco Giants",
  "SLN": "St. Louis Cardinals",
  "TBA": "Tampa Bay Rays",
  "TEX": "Texas Rangers",
  "TOR": "Toronto Blue Jays",
  "WAS": "Washington Nationals"
}



var width = 960,
    height = 500;

var projection = d3.geo.albersUsa()
    .scale(1000)
    .translate([width / 2, height / 2]);

queue()
.defer(d3.json, 'bin/zips.json')
.defer(d3.csv, '2015.csv')
.await(function(error, zipcodes, sheduleRes) {
  zips = zipcodes
  shedule = sheduleRes

  // Compute projected locations of each zipcode.
  zipcodes.forEach(function(d) {
    var p = projection([+d.lon, +d.lat]);
    if (p) d.x = Math.round(p[0]), d.y = Math.round(p[1]);
  });


  change();

  function change() {
    // Select old canvases to remove after fade.
    var canvas0 = d3.selectAll("canvas");

    var canvas1 = d3.select("body").insert("canvas", "input")
        .attr("width", width)
        .attr("height", height)
        .style("opacity", 1);

    var context = canvas1.node().getContext("2d");
    context.fillStyle = "#fff";
    context.fillRect(0, 0, width, height);

    // Render the active zipcodes.
    context.globalAlpha = 1;
    context.fillStyle = "#555";
    zipcodes.forEach(function(d) {
      if (!d.mlb) return
      context.fillRect(d.x, d.y, d.mlb.length, d.mlb.length);
    });

  }
});

</script>
